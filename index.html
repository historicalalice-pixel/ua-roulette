<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UA Travel Roulette ‚Äî 3D Carousel</title>

  <style>
    :root{
      --bg1:#060914;
      --bg2:#0b1028;
      --card:#10183acc;
      --stroke:#ffffff1a;
      --text:#eaf0ff;
      --muted:#aab6e6;
      --accent:#7aa6ff;
      --accent2:#00ffd5;
      --warn:#ffd166;
      --shadow: 0 22px 70px rgba(0,0,0,.55);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1100px 650px at 20% 10%, #7aa6ff22, transparent 60%),
        radial-gradient(900px 600px at 85% 25%, #00ffd518, transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
      padding:18px;
    }
    .app{width:min(1100px,100%); margin:0 auto; display:grid; gap:14px;}
    header{display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;}
    h1{margin:0; font-size:clamp(22px,3vw,30px); font-weight:950; letter-spacing:.2px}
    .sub{margin:6px 0 0; color:var(--muted); font-size:14px; line-height:1.4; max-width: 60ch;}
    .pills{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .pill{border:1px solid var(--stroke); background:#ffffff0b; color:var(--muted); border-radius:999px; padding:7px 10px; font-size:12px;}

    .grid{display:grid; grid-template-columns: 1fr 420px; gap:14px; align-items:start;}
    @media(max-width:980px){ .grid{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg,#111a3acc,#0b1028cc);
      border-radius:18px;
      overflow:hidden;
      box-shadow:var(--shadow);
    }
    .cardHead{padding:14px; border-bottom:1px solid var(--stroke); display:flex; justify-content:space-between; gap:10px; align-items:center;}
    .cardHead h2{margin:0; font-size:14px; color:var(--muted); letter-spacing:.2px; font-weight:900; text-transform:uppercase;}
    .controls{display:flex; gap:10px; flex-wrap:wrap;}
    button{
      appearance:none; border:1px solid var(--stroke); background:#ffffff10; color:var(--text);
      padding:12px 14px; border-radius:12px; font-weight:900; cursor:pointer;
      transition: transform .06s ease, background .2s ease, opacity .2s ease, border-color .2s ease;
      font-size:14px;
    }
    button:hover{background:#ffffff18}
    button:active{transform: translateY(1px)}
    .primary{border-color:#7aa6ff55; background:linear-gradient(180deg,#7aa6ff2a,#7aa6ff14)}
    .primary:hover{background:#7aa6ff33}
    .ghost{background:transparent}
    .danger{border-color:#ff6b6b55; background:linear-gradient(180deg,#ff6b6b22,#ff6b6b10)}
    .danger:hover{background:#ff6b6b28}

    /* ====== 3D Carousel ====== */
    .stage{
      position:relative;
      height: 520px;
      display:grid;
      place-items:center;
      perspective: 1200px;
      overflow:hidden;
      background:
        radial-gradient(700px 450px at 50% 40%, #7aa6ff10, transparent 60%),
        radial-gradient(600px 400px at 60% 70%, #00ffd50c, transparent 60%);
    }
    @media(max-width:700px){ .stage{height: 560px;} }

    .carousel{
      position:relative;
      width: min(820px, 100%);
      height: 420px;
      transform-style: preserve-3d;
      transition: transform 1100ms cubic-bezier(.2,.8,.2,1);
    }

    .c-card{
      position:absolute;
      left:50%;
      top:50%;
      width: 320px;
      height: 410px;
      transform-style: preserve-3d;
      transform-origin: center center;
      border:1px solid var(--stroke);
      border-radius: 18px;
      overflow:hidden;
      background:#0b1028;
      box-shadow: 0 18px 50px rgba(0,0,0,.45);
      translate:-50% -50%;
      cursor:pointer;
      transition: filter .2s ease, transform 1100ms cubic-bezier(.2,.8,.2,1), opacity .2s ease;
    }
    .c-card:hover{filter: brightness(1.05)}
    .c-card .img{
      height: 55%;
      background:#111;
      position:relative;
    }
    .c-card img{
      width:100%; height:100%; object-fit:cover; display:block;
      transform: scale(1.02);
      filter: saturate(1.05) contrast(1.02);
    }
    .shade{
      position:absolute; inset:0;
      background: linear-gradient(180deg, #0000 55%, #000b 100%);
    }
    .c-body{padding:12px;}
    .title{font-weight:950; font-size:18px; line-height:1.1; letter-spacing:.2px; margin:2px 0 6px;}
    .meta{color:var(--muted); font-size:12px; line-height:1.4;}
    .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:10px;}
    .tag{font-size:11px; padding:6px 9px; border:1px solid var(--stroke); border-radius:999px; background:#ffffff0b; color:var(--muted);}

    .hint{
      position:absolute;
      bottom:12px;
      left:12px;
      right:12px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      pointer-events:none;
    }

    /* Details panel */
    .details{padding:14px; display:grid; gap:12px;}
    .box{border:1px solid var(--stroke); background:#ffffff07; border-radius:14px; padding:12px;}
    .box h3{margin:0 0 8px; font-size:14px; letter-spacing:.2px}
    .box p{margin:0; color:var(--muted); line-height:1.55; font-size:14px}
    .box ul{margin:8px 0 0 18px; line-height:1.55; font-size:14px; color:var(--text); opacity:.92}
    .actionRow{display:flex; gap:10px; flex-wrap:wrap;}
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}

    /* Filters */
    .filters{padding:14px; display:grid; gap:10px;}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media(max-width:980px){ .row{grid-template-columns:1fr} }
    label{display:grid; gap:6px; font-size:12px; color:var(--muted)}
    select,input{
      border:1px solid var(--stroke);
      background:#ffffff08;
      color:var(--text);
      border-radius:12px;
      padding:10px 10px;
      outline:none;
      font-weight:700;
    }
    .small{font-size:12px; color:var(--muted); line-height:1.4;}
    .count{font-weight:900; color:var(--text)}
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div>
        <h1>üåÄ UA Travel Roulette ‚Äî 3D Carousel</h1>
        <div class="sub">
          –ù–∞—Ç–∏—Å–Ω–∏ <b>–ö—Ä—É—Ç–∏—Ç–∏</b> ‚Äî –∫–∞—Ä—É—Å–µ–ª—å ‚Äú–¥–æ–∫—Ä—É—á—É—î‚Äù –¥–æ –≤–∏–ø–∞–¥–∫–æ–≤–æ–≥–æ –º—ñ—Å—Ü—è <b>–±–µ–∑ –ø–æ–≤—Ç–æ—Ä—ñ–≤</b>.
          –ö–ª—ñ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ñ–π –∫–∞—Ä—Ç—Ü—ñ ‚Äî –¥–µ—Ç–∞–ª—ñ —Ç–∞ –º–∞—Ä—à—Ä—É—Ç –Ω–∞ <b>1/2 –¥–Ω—ñ</b>.
        </div>
      </div>
      <div class="pills">
        <div class="pill">3D-–∫–∞—Ä—É—Å–µ–ª—å</div>
        <div class="pill">–§–æ—Ç–æ</div>
        <div class="pill">–§—ñ–ª—å—Ç—Ä–∏</div>
        <div class="pill"><span id="leftCount">‚Äî</span> –º—ñ—Å—Ü—å</div>
      </div>
    </header>

    <div class="grid">
      <!-- Main: carousel + details -->
      <section class="card">
        <div class="cardHead">
          <h2>–ö–∞—Ä—É—Å–µ–ª—å</h2>
          <div class="controls">
            <button class="primary" id="spinBtn">üé≤ –ö—Ä—É—Ç–∏—Ç–∏</button>
            <button class="ghost" id="toggleDetailsBtn">üìå –î–µ—Ç–∞–ª—ñ</button>
            <button class="danger" id="resetBtn" title="–°–∫–∏–Ω—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å">‚ôªÔ∏è –°–∫–∏–Ω—É—Ç–∏</button>
          </div>
        </div>

        <div class="stage">
          <div class="carousel" id="carousel"></div>
          <div class="hint">
            <span>Space ‚Äî –∫—Ä—É—Ç–∏—Ç–∏</span>
            <span>–ö–ª—ñ–∫ –ø–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ñ–π ‚Äî –¥–µ—Ç–∞–ª—ñ</span>
          </div>
        </div>

        <div class="details" id="details" style="display:none;">
          <div class="box">
            <h3 id="dTitle">‚Äî</h3>
            <p id="dDesc">–ù–∞—Ç–∏—Å–Ω–∏ ‚Äú–ö—Ä—É—Ç–∏—Ç–∏‚Äù.</p>
          </div>
          <div class="box">
            <h3>–ú–∞—Ä—à—Ä—É—Ç</h3>
            <div id="dRoute"></div>
            <p class="small" style="margin-top:10px;">
              ‚ö†Ô∏è –í –£–∫—Ä–∞—ó–Ω—ñ —Ç—Ä–∏–≤–∞—î –≤—ñ–π–Ω–∞. –ü–µ—Ä–µ–¥ –ø–æ—ó–∑–¥–∫–æ—é –ø–µ—Ä–µ–≤—ñ—Ä —Ç—Ä–∏–≤–æ–≥–∏/–æ–±–º–µ–∂–µ–Ω–Ω—è/–∫–æ–º–µ–Ω–¥–∞–Ω—Ç—Å—å–∫—É –≥–æ–¥–∏–Ω—É —Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å –º—ñ—Å—Ü—å.
            </p>
          </div>
          <div class="actionRow">
            <button class="ghost" id="mapsBtn">üó∫Ô∏è Google Maps</button>
            <button class="ghost" id="shareBtn">üîó –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—å</button>
            <button class="ghost" id="officialBtn">‚úÖ –û—Ñ—ñ—Ü—ñ–π–Ω—ñ –¥–∂–µ—Ä–µ–ª–∞</button>
          </div>
        </div>
      </section>

      <!-- Side: filters -->
      <aside class="card">
        <div class="cardHead">
          <h2>–§—ñ–ª—å—Ç—Ä–∏</h2>
          <div class="pill"><span class="count" id="countTxt">‚Äî</span></div>
        </div>
        <div class="filters">
          <div class="row">
            <label>
              –†–µ–≥—ñ–æ–Ω
              <select id="regionSel"></select>
            </label>
            <label>
              –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
              <select id="daysSel">
                <option value="1">1 –¥–µ–Ω—å</option>
                <option value="2">2 –¥–Ω—ñ</option>
              </select>
            </label>
          </div>

          <div class="row">
            <label>
              –ö–∞—Ç–µ–≥–æ—Ä—ñ—è
              <select id="catSel"></select>
            </label>
            <label>
              –ü–æ—à—É–∫
              <input id="searchInp" placeholder="–æ–∑–µ—Ä–æ, —Ñ–æ—Ä—Ç–µ—Ü—è, –ö–∞—Ä–ø–∞—Ç–∏‚Ä¶" />
            </label>
          </div>

          <button class="ghost" id="applyBtn">üîé –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>

          <p class="small">
            –£–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä—ñ (localStorage). ‚Äú–°–∫–∏–Ω—É—Ç–∏‚Äù ‚Äî –¥–æ–∑–≤–æ–ª—è—î –ø–æ–≤—Ç–æ—Ä–∏.
          </p>
        </div>
      </aside>
    </div>
  </div>

<script>
/* =========================
   DATA (–º–æ–∂–µ—à —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏)
   –§–æ—Ç–æ ‚Äî Unsplash Source (–±–µ–∑ –∫–ª—é—á–∞), –Ω–æ—Ä–º –¥–ª—è MVP.
========================= */
const PLACES = [
  {
    id:"synevyr",
    name:"–û–∑–µ—Ä–æ –°–∏–Ω–µ–≤–∏—Ä",
    region:"–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞",
    category:"–ü—Ä–∏—Ä–æ–¥–∞",
    duration:[1,2],
    tags:["–ö–∞—Ä–ø–∞—Ç–∏","–æ–∑–µ—Ä–æ","–ø—Ä–æ–≥—É–ª—è–Ω–∫–∞"],
    photoQuery:"Synevyr lake Carpathians Ukraine",
    coord:"48.6170,23.6890",
    desc:"–ù–∞–π–≤—ñ–¥–æ–º—ñ—à–µ –≥—ñ—Ä—Å—å–∫–µ –æ–∑–µ—Ä–æ –£–∫—Ä–∞—ó–Ω–∏: —Ö–≤–æ–π–Ω—ñ —Å—Ö–∏–ª–∏, —Ç–∏—à–∞ —ñ –ª–µ–≥–∫—ñ –º–∞—Ä—à—Ä—É—Ç–∏.",
    day1:["–ö–æ–ª–æ –Ω–∞–≤–∫–æ–ª–æ –æ–∑–µ—Ä–∞ + –æ–≥–ª—è–¥–æ–≤—ñ","–ï–∫–æ-—Å—Ç–µ–∂–∫–∞ –≤ –ª—ñ—Å—ñ","–ö–æ–ª–∏–±–∞/–∫–∞–≤–∞ –ø–æ—Ä—É—á"],
    day2:["–†–∞–Ω–æ–∫ –Ω–∞ —Ç—É–º–∞–Ω—ñ (—è–∫ –ø–æ—â–∞—Å—Ç–∏—Ç—å)","–î–æ–¥–∞—Ç–∫–æ–≤–∏–π —Ç—Ä–µ–∫/–ª–æ–∫–∞—Ü—ñ—è –≤ —Ä–∞–π–æ–Ω—ñ","–í–µ—á–µ—Ä—è –≤ –ú—ñ–∂–≥—ñ—Ä‚Äô—ó"]
  },
  {
    id:"kamianets",
    name:"–ö–∞–º'—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∞ —Ñ–æ—Ä—Ç–µ—Ü—è",
    region:"–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞",
    category:"–Ü—Å—Ç–æ—Ä—ñ—è",
    duration:[1,2],
    tags:["—Ñ–æ—Ä—Ç–µ—Ü—è","—Å—Ç–∞—Ä–µ –º—ñ—Å—Ç–æ","–∫–∞–Ω—å–π–æ–Ω"],
    photoQuery:"Kamianets-Podilskyi fortress Ukraine",
    coord:"48.6730,26.5780",
    desc:"–§–æ—Ä—Ç–µ—Ü—è + —Å—Ç–∞—Ä–µ –º—ñ—Å—Ç–æ –∑ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–∏–º–∏ –≤—É–ª–∏—Ü—è–º–∏ —ñ –≤–∏–¥–∞–º–∏ –Ω–∞ –∫–∞–Ω—å–π–æ–Ω –°–º–æ—Ç—Ä–∏—á–∞.",
    day1:["–§–æ—Ä—Ç–µ—Ü—è (–µ–∫—Å–∫—É—Ä—Å—ñ—è/–º—É–∑–µ—ó)","–°—Ç–∞—Ä–µ –º—ñ—Å—Ç–æ (–ø–ª–æ—â–∞, —Ä–∞—Ç—É—à–∞)","–û–≥–ª—è–¥–æ–≤—ñ –Ω–∞ –∫–∞–Ω—å–π–æ–Ω –Ω–∞ –∑–∞—Ö–æ–¥—ñ"],
    day2:["–†–∞–Ω–∫–æ–≤–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∞ —Å—Ç–∞—Ä–∏–º –º—ñ—Å—Ç–æ–º","–î–æ–¥–∞—Ç–∫–æ–≤—ñ –º—É–∑–µ—ó/–∫–∞–≤‚Äô—è—Ä–Ω—ñ","–û–ø—Ü—ñ–π–Ω–æ: –•–æ—Ç–∏–Ω"]
  },
  {
    id:"tustan",
    name:"–¢—É—Å—Ç–∞–Ω—å",
    region:"–õ—å–≤—ñ–≤—Å—å–∫–∞",
    category:"–ü—Ä–∏—Ä–æ–¥–∞",
    duration:[1,2],
    tags:["—Å–∫–µ–ª—ñ","–ø–æ—Ö—ñ–¥","—ñ—Å—Ç–æ—Ä—ñ—è"],
    photoQuery:"Tustan fortress rocks Ukraine",
    coord:"49.2153,23.4110",
    desc:"–°–∫–µ–ª—å–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Å —ñ —ñ—Å—Ç–æ—Ä—ñ—è —Ñ–æ—Ä—Ç–µ—Ü—ñ: –ø—Ä–∏—Ä–æ–¥–∞ + –æ–≥–ª—è–¥–æ–≤—ñ ‚Äî –¥—É–∂–µ ‚Äú–∫—ñ–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ‚Äù.",
    day1:["–ü—ñ–¥–π–æ–º –¥–æ —Å–∫–µ–ª—å —ñ –æ–≥–ª—è–¥–æ–≤—ñ","–í—ñ–∑–∏—Ç-—Ü–µ–Ω—Ç—Ä (—è–∫—â–æ –≤—ñ–¥–∫—Ä.)","–§–æ—Ç–æ –Ω–∞ –∑–∞—Ö–æ–¥—ñ"],
    day2:["–õ–µ–≥–∫–∏–π —Ö–∞–π–∫ —É —Ä–∞–π–æ–Ω—ñ –£—Ä–∏—á–∞","–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞–Ω–æ—Ä–∞–º–∏","–°—Ö—ñ–¥–Ω–∏—Ü—è/–∫–∞–≤–∞ (–æ–ø—Ü—ñ–π–Ω–æ)"]
  },
  {
    id:"dnister",
    name:"–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π –∫–∞–Ω—å–π–æ–Ω (–æ–≥–ª—è–¥–æ–≤—ñ —Ç–æ—á–∫–∏)",
    region:"–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞",
    category:"–ü—Ä–∏—Ä–æ–¥–∞",
    duration:[1,2],
    tags:["–ø–∞–Ω–æ—Ä–∞–º–∞","—Ä—ñ—á–∫–∞","–ø–µ–π–∑–∞–∂"],
    photoQuery:"Dniester canyon Ukraine viewpoint",
    coord:"",
    desc:"–ü–∞–Ω–æ—Ä–∞–º–∏ –Ω–∞–¥ –î–Ω—ñ—Å—Ç—Ä–æ–º ‚Äî —Ç–æ–ø –¥–ª—è –æ–≥–ª—è–¥–æ–≤–∏—Ö —ñ —Ñ–æ—Ç–æ –Ω–∞ –∑–æ–ª–æ—Ç—ñ–π –≥–æ–¥–∏–Ω—ñ.",
    day1:["1‚Äì2 –æ–≥–ª—è–¥–æ–≤—ñ —Ç–æ—á–∫–∏","–ü—Ä–æ–≥—É–ª—è–Ω–∫–∞ —Å—Ç–µ–∂–∫–∞–º–∏","–ó–∞—Ö—ñ–¥ —Å–æ–Ω—Ü—è/—Ñ–æ—Ç–æ"],
    day2:["–©–µ 1‚Äì2 —Ç–æ—á–∫–∏","–ü—ñ–∫–Ω—ñ–∫/–∫–∞–≤–∞ –∑ –≤–∏–¥–æ–º","–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –º–∞–ª—å–æ–≤–Ω–∏—á–∏–º –º–∞—Ä—à—Ä—É—Ç–æ–º"]
  },
  {
    id:"sofia",
    name:"–°–æ—Ñ—ñ—è –ö–∏—ó–≤—Å—å–∫–∞",
    region:"–ö–∏—ó–≤",
    category:"–ú—ñ—Å—Ç–æ",
    duration:[1],
    tags:["UNESCO","–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞","–º—É–∑–µ–π"],
    photoQuery:"Saint Sophia Cathedral Kyiv Ukraine",
    coord:"50.4529,30.5144",
    desc:"–ö—É–ª—å—Ç–æ–≤–∞ –ø–∞–º‚Äô—è—Ç–∫–∞ –ö–∏—î–≤–∞: –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞, –º—É–∑–µ–π–Ω–∏–π –∫–æ–º–ø–ª–µ–∫—Å —ñ —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.",
    day1:["–°–æ–±–æ—Ä + –µ–∫—Å–ø–æ–∑–∏—Ü—ñ—ó","–î–∑–≤—ñ–Ω–Ω–∏—Ü—è (—è–∫—â–æ –¥–æ—Å—Ç—É–ø–Ω–æ)","–ü—Ä–æ–≥—É–ª—è–Ω–∫–∞ —Ü–µ–Ω—Ç—Ä–æ–º –ø–æ—Ä—É—á"],
    day2:[]
  },
  {
    id:"shatsk",
    name:"–®–∞—Ü—å–∫—ñ –æ–∑–µ—Ä–∞ (–°–≤—ñ—Ç—è–∑—å)",
    region:"–í–æ–ª–∏–Ω—Å—å–∫–∞",
    category:"–í—ñ–¥–ø–æ—á–∏–Ω–æ–∫",
    duration:[2],
    tags:["–æ–∑–µ—Ä–∞","–ø–ª—è–∂","—Ä–µ–ª–∞–∫—Å"],
    photoQuery:"Svitiaz lake Shatsk Ukraine",
    coord:"",
    desc:"–í–æ–¥–∞, –ø–ª—è–∂—ñ, –ø—Ä–æ–≥—É–ª—è–Ω–∫–∏ ‚Äî —ñ–¥–µ–∞–ª—å–Ω–æ –Ω–∞ 2 –¥–Ω—ñ –¥–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.",
    day1:["–ó–∞—ó–∑–¥ + –ø–ª—è–∂","–í–µ–ª–æ–ø—Ä–æ–≥—É–ª—è–Ω–∫–∞","–ó–∞—Ö—ñ–¥ —Å–æ–Ω—Ü—è –±—ñ–ª—è –≤–æ–¥–∏"],
    day2:["–†–∞–Ω–∫–æ–≤–∞ –ø—Ä–æ–≥—É–ª—è–Ω–∫–∞","–ö–æ—Ä–æ—Ç–∫–∏–π –º–∞—Ä—à—Ä—É—Ç –ª—ñ—Å–æ–º","–í–∏—ó–∑–¥"]
  }
];

/* =========================
   STATE / FILTERS / UNIQUE
========================= */
const SEEN_KEY = "ua_carousel_seen_v1";
let seen = loadSeen();

function loadSeen(){
  try { return new Set(JSON.parse(localStorage.getItem(SEEN_KEY) || "[]")); }
  catch { return new Set(); }
}
function saveSeen(){ localStorage.setItem(SEEN_KEY, JSON.stringify([...seen])); }

const regionSel = document.getElementById("regionSel");
const catSel = document.getElementById("catSel");
const daysSel = document.getElementById("daysSel");
const searchInp = document.getElementById("searchInp");
const applyBtn = document.getElementById("applyBtn");
const leftCount = document.getElementById("leftCount");
const countTxt = document.getElementById("countTxt");

const carouselEl = document.getElementById("carousel");
const spinBtn = document.getElementById("spinBtn");
const resetBtn = document.getElementById("resetBtn");
const toggleDetailsBtn = document.getElementById("toggleDetailsBtn");
const detailsEl = document.getElementById("details");

const dTitle = document.getElementById("dTitle");
const dDesc = document.getElementById("dDesc");
const dRoute = document.getElementById("dRoute");
const mapsBtn = document.getElementById("mapsBtn");
const shareBtn = document.getElementById("shareBtn");
const officialBtn = document.getElementById("officialBtn");

let filtered = [];
let currentIndex = 0;   // index within filtered array (central)
let angle = 0;
let spinning = false;

function photoUrl(query){
  return `https://source.unsplash.com/featured/900x700/?${encodeURIComponent(query)}`;
}
function mapsUrl(place){
  if (place.coord && place.coord.includes(",")) return `https://www.google.com/maps?q=${encodeURIComponent(place.coord)}`;
  return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(place.name + " –£–∫—Ä–∞—ó–Ω–∞")}`;
}
function officialUrl(){
  return "https://alerts.in.ua/";
}

function unique(arr){
  return [...new Set(arr)];
}
function fillSelect(sel, values){
  sel.innerHTML = "";
  values.forEach(v=>{
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    sel.appendChild(o);
  });
}

const REGIONS = ["–í—Å—ñ", ...unique(PLACES.map(p=>p.region)).sort()];
const CATS = ["–í—Å—ñ", ...unique(PLACES.map(p=>p.category)).sort()];
fillSelect(regionSel, REGIONS);
fillSelect(catSel, CATS);

function applyFilters(){
  const reg = regionSel.value;
  const cat = catSel.value;
  const days = Number(daysSel.value);
  const q = (searchInp.value || "").trim().toLowerCase();

  filtered = PLACES.filter(p=>{
    if (reg !== "–í—Å—ñ" && p.region !== reg) return false;
    if (cat !== "–í—Å—ñ" && p.category !== cat) return false;
    if (!p.duration.includes(days)) return false;
    if (seen.has(p.id)) return false;
    if (q){
      const hay = [
        p.name, p.region, p.category, p.desc,
        ...(p.tags||[]),
        ...(p.day1||[]),
        ...(p.day2||[])
      ].join(" ").toLowerCase();
      if (!hay.includes(q)) return false;
    }
    return true;
  });

  leftCount.textContent = filtered.length;
  countTxt.textContent = filtered.length;

  // –Ø–∫—â–æ –Ω—ñ—á–æ–≥–æ –Ω–µ–º–∞ ‚Äî –ø–æ–∫–∞–∂–µ–º–æ –ø–æ—Ä–æ–∂–Ω—å–æ, –∞–ª–µ –Ω–µ –ø–∞–¥–∞—î–º–æ
  currentIndex = 0;
  angle = 0;
  renderCarousel();
}

applyBtn.addEventListener("click", applyFilters);
regionSel.addEventListener("change", applyFilters);
catSel.addEventListener("change", applyFilters);
daysSel.addEventListener("change", applyFilters);
searchInp.addEventListener("keydown", (e)=>{ if(e.key==="Enter") applyFilters(); });

/* =========================
   3D CAROUSEL RENDER
========================= */
function renderCarousel(){
  carouselEl.innerHTML = "";

  const items = filtered.length ? filtered : [{ name:"–ù–µ–º–∞—î –º—ñ—Å—Ü—å", region:"‚Äî", category:"‚Äî", tags:[], photoQuery:"Ukraine", desc:"–ó–º—ñ–Ω–∏ —Ñ—ñ–ª—å—Ç—Ä –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äú–°–∫–∏–Ω—É—Ç–∏‚Äù." }];
  const n = items.length;

  // –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–∞—Ä—É—Å–µ–ª—ñ
  const radius = 380;      // –¥–∏—Å—Ç–∞–Ω—Ü—ñ—è –ø–æ Z
  const spread = 360 / Math.max(n, 6); // —â–æ–± –Ω–µ –∑–ª–∏–ø–∞–ª–æ—Å—å, —è–∫—â–æ –º–∞–ª–æ –∫–∞—Ä—Ç–æ–∫

  items.forEach((p, i)=>{
    const card = document.createElement("div");
    card.className = "c-card";

    const imgWrap = document.createElement("div");
    imgWrap.className = "img";

    const img = document.createElement("img");
    img.loading = "lazy";
    img.alt = p.name || "place";
    img.src = photoUrl(p.photoQuery || p.name || "Ukraine");

    const shade = document.createElement("div");
    shade.className = "shade";

    imgWrap.appendChild(img);
    imgWrap.appendChild(shade);

    const body = document.createElement("div");
    body.className = "c-body";

    const t = document.createElement("div");
    t.className = "title";
    t.textContent = p.name;

    const m = document.createElement("div");
    m.className = "meta";
    m.textContent = `${p.region || "‚Äî"} ¬∑ ${p.category || "‚Äî"}`;

    const tags = document.createElement("div");
    tags.className = "tags";
    (p.tags || []).slice(0,4).forEach(x=>{
      const s = document.createElement("span");
      s.className = "tag";
      s.textContent = x;
      tags.appendChild(s);
    });

    body.appendChild(t);
    body.appendChild(m);
    body.appendChild(tags);

    card.appendChild(imgWrap);
    card.appendChild(body);

    // –ø–æ–∑–∏—Ü—ñ—é—î–º–æ –ø–æ –∫–æ–ª—É
    const theta = (i - currentIndex) * spread;
    const transform = `rotateY(${theta}deg) translateZ(${radius}px)`;
    card.style.transform = transform;

    // —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –∫–∞—Ä—Ç–∫–∞
    const isCenter = (i === currentIndex);
    card.style.opacity = isCenter ? "1" : "0.65";
    card.style.filter = isCenter ? "none" : "blur(0.4px)";
    card.style.pointerEvents = isCenter ? "auto" : "none";

    card.addEventListener("click", ()=>{
      if (!filtered.length) return;
      showDetails(filtered[currentIndex]);
      detailsEl.style.display = "grid";
    });

    carouselEl.appendChild(card);
  });

  // –∑–∞–≥–∞–ª—å–Ω–∏–π –ø–æ–≤–æ—Ä–æ—Ç —Å—Ü–µ–Ω–∏
  carouselEl.style.transform = `rotateY(${angle}deg)`;
}

function showDetails(place){
  const days = Number(daysSel.value);
  dTitle.textContent = `${place.name} ‚Äî ${place.region} ¬∑ ${place.category}`;
  dDesc.textContent = place.desc;

  // –º–∞—Ä—à—Ä—É—Ç
  dRoute.innerHTML = "";
  const mkList = (title, items)=>{
    const wrap = document.createElement("div");
    wrap.style.marginBottom = "10px";
    const h = document.createElement("div");
    h.style.fontWeight = "950";
    h.style.marginBottom = "6px";
    h.textContent = title;
    const ul = document.createElement("ul");
    (items || []).forEach(x=>{
      const li = document.createElement("li");
      li.textContent = x;
      ul.appendChild(li);
    });
    wrap.appendChild(h);
    wrap.appendChild(ul);
    return wrap;
  };

  dRoute.appendChild(mkList("–î–µ–Ω—å 1", place.day1 || []));
  if (days === 2) dRoute.appendChild(mkList("–î–µ–Ω—å 2", place.day2 || []));

  mapsBtn.onclick = ()=> window.open(mapsUrl(place), "_blank", "noopener");
  officialBtn.onclick = ()=> window.open(officialUrl(), "_blank", "noopener");
  shareBtn.onclick = async ()=>{
    const text = `${place.name} ‚Äî ${place.region}. –ú–∞—Ä—à—Ä—É—Ç –Ω–∞ ${days} –¥–µ–Ω—å(–¥–Ω—ñ).`;
    try{
      if (navigator.share){
        await navigator.share({ title: place.name, text, url: location.href });
      } else {
        await navigator.clipboard.writeText(text + "\n" + location.href);
        alert("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ ‚úÖ");
      }
    } catch {}
  };
}

/* =========================
   SPIN / PICK
========================= */
function spin(){
  if (spinning) return;

  if (!filtered.length){
    alert("–ù–µ–º–∞—î –º—ñ—Å—Ü—å –ø—ñ–¥ —Ñ—ñ–ª—å—Ç—Ä. –ó–º—ñ–Ω–∏ —Ñ—ñ–ª—å—Ç—Ä –∞–±–æ –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äú–°–∫–∏–Ω—É—Ç–∏‚Äù.");
    return;
  }

  spinning = true;
  detailsEl.style.display = "none";

  // –≤–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–±–∏—Ä–∞—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π —ñ–Ω–¥–µ–∫—Å —è–∫ ‚Äú–ø–µ—Ä–µ–º–æ–∂–µ—Ü—å‚Äù
  const targetIndex = Math.floor(Math.random() * filtered.length);
  const n = filtered.length;

  // —Å–∫—ñ–ª—å–∫–∏ –∫—Ä–æ–∫—ñ–≤ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–∏, —â–æ–± –≤–∏–≥–ª—è–¥–∞–ª–æ –∫—Ä—É—Ç–æ (–º—ñ–Ω—ñ–º—É–º 2 –∫–æ–ª–∞)
  const loops = 2 + Math.floor(Math.random()*2); // 2-3 loops
  const steps = loops * n + ((targetIndex - currentIndex + n) % n);

  const start = performance.now();
  const dur = 1600 + Math.random()*700;

  const startIdx = currentIndex;

  function easeOutCubic(t){ return 1 - Math.pow(1-t,3); }

  function frame(now){
    const t = Math.min(1, (now - start) / dur);
    const e = easeOutCubic(t);

    // –ø—Ä–æ–≥—Ä–µ—Å —É ‚Äú–∫—Ä–æ–∫–∞—Ö‚Äù
    const prog = Math.floor(e * steps);
    currentIndex = (startIdx + prog) % n;

    // —Ç—Ä–æ—Ö–∏ ‚Äú–∫–∞—á–∞–Ω–Ω—è‚Äù —Å—Ü–µ–Ω–∏
    angle = - (e * steps * 14); // degrees
    renderCarousel();

    if (t < 1){
      requestAnimationFrame(frame);
    } else {
      // —Ñ—ñ–Ω–∞–ª
      currentIndex = targetIndex;
      angle = -steps * 14;
      renderCarousel();

      // mark seen
      const win = filtered[currentIndex];
      seen.add(win.id);
      saveSeen();

      // –ø–µ—Ä–µ—Ä–∞—Ö—É–≤–∞—Ç–∏ filtered (–ø—Ä–∏–±—Ä–∞—Ç–∏ –≤–∏–≥—Ä–∞–Ω–µ)
      applyFilters();

      // –ø–æ–∫–∞–∑–∞—Ç–∏ –¥–µ—Ç–∞–ª—ñ –ø–µ—Ä–µ–º–æ–∂—Ü—è
      showDetails(win);
      detailsEl.style.display = "grid";

      spinning = false;
    }
  }
  requestAnimationFrame(frame);
}

spinBtn.addEventListener("click", spin);
document.addEventListener("keydown", (e)=>{
  if (e.code === "Space"){ e.preventDefault(); spin(); }
});

resetBtn.addEventListener("click", ()=>{
  if (confirm("–°–∫–∏–Ω—É—Ç–∏ —É–Ω—ñ–∫–∞–ª—å–Ω—ñ—Å—Ç—å (–ø–æ–≤—Ç–æ—Ä–∏ –∑–Ω–æ–≤—É –¥–æ–∑–≤–æ–ª–µ–Ω—ñ)?")){
    seen = new Set();
    saveSeen();
    applyFilters();
    alert("–°–∫–∏–Ω—É—Ç–æ ‚úÖ");
  }
});

toggleDetailsBtn.addEventListener("click", ()=>{
  if (detailsEl.style.display === "none") detailsEl.style.display = "grid";
  else detailsEl.style.display = "none";
});

// init
applyFilters();
renderCarousel();
</script>
</body>
</html>